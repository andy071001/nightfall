<!DOCTYPE html>
<html>
<head>
<script src="jquery.min.js"></script>
<script>
/**
 * 
 * @author : snow@firebloom.cc
 * @license : GPLv3
 */
  var mutedTopics = localStorage['mutedTopics'],
    blockedUsers = localStorage['blockedUsers'];
  
  if('string' === typeof mutedTopics )
  {
    mutedTopics = mutedTopics.split(',');
  }
  else
  {
    mutedTopics = [];
  }
  
  if('string' === typeof blockedUsers)
  {
    tmp = blockedUsers.split(',');
    blockedUsers = [];
    $.each(tmp, function(idx, el)
    {
      if(el.length > 0)
      {
        blockedUsers.push(el);
      }
    });
  }
  else
  {
    blockedUsers = [];
  }
    
  chrome.extension.onRequest.addListener(function(request, sender, sendResponse)
  {
    if(request.action)
    {
      switch(request.action)
      {
        case 'showPgAct':
          chrome.pageAction.show(sender.tab.id);
          sendResponse();
        break;
        
        case 'muteTopic':
          if(request.objectId)
          {
            sendResponse({"done":1});
            
            if(-1 === $.inArray(request.objectId, mutedTopics))
            {
              mutedTopics.push(request.objectId);
              localStorage['mutedTopics'] = mutedTopics;
            }
          }
          else
          {
            sendResponse({"done":0});
          }
        break;
        
        case 'blockUser':
          if(request.objectId)
          {
            sendResponse({"done":1});
            
            if(-1 === $.inArray(request.objectId, blockedUsers))
            {
              blockedUsers.push(request.objectId);
              localStorage['blockedUsers'] = blockedUsers;
            }
          }
          else
          {
            sendResponse({"done":0});
          }
        break;
        
        case 'getData':
          sendResponse({
            "done" : 1,
            "mutedTopics" : mutedTopics,
            "blockedUsers" : blockedUsers
          });
        break;
        
        case 'clearData':
          localStorage['mutedTopics'] = mutedTopics = [];
          localStorage['blockedUsers'] = blockedUsers = [];
          sendResponse({"done":1});          
        break;
      }
    }
    else
    {
      sendResponse({"done":0});
    }
  });
</script>
</head>
</html>