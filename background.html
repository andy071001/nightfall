<!DOCTYPE html>
<html>
<head>
<script src="jquery.min.js"></script>
<script>
  var mutedTopics = localStorage['mutedTopics'],
    ignoredUsers = localStorage['ignoredUsers'];
  
  if('string' === typeof mutedTopics )
  {
    mutedTopics = mutedTopics.split(',');
  }
  else
  {
    mutedTopics = [];
  }
  
  if('string' === typeof ignoredUsers)
  {
    ignoredUsers = ignoredUsers.split(',');
  }
  else
  {
    ignoredUsers = [];
  }
  
  function muteTopic(topicId)
  {
    if(-1 === $.inArray(topicId, mutedTopics))
    {
      mutedTopics.push(topicId);
      localStorage['mutedTopics'] = mutedTopics;
    }
  }
  
  function getMutedTopics()
  {
    return mutedTopics;
  }
  
  function clearMutedTopics()
  {
    localStorage['mutedTopics'] = mutedTopics = [];
  }
  
  function ignoreUser(userId)
  {
    if(-1 === $.inArray(userId, ignoredUsers))
    {
      ignoredUsers.push(userId);
      localStorage['ignoredUsers'] = ignoredUsers;
    }
  }
  
  function getIgnoredUsers()
  {
    return ignoredUsers;
  }
  
  function clearIgnoredUsers()
  {
    localStorage['ignoredUsers'] = ignoredUsers = [];
  }
    
  chrome.extension.onRequest.addListener(function(request, sender, sendResponse)
  {
    if(request.action)
    {
      switch(request.action)
      {
        case 'muteTopic':
          if(request.objectId)
          {
            sendResponse({"done":1});
            muteTopic(request.objectId);
          }
          else
          {
            sendResponse({"done":0});
          }
        break;
        
        case 'getMutedTopics':
          sendResponse({
            "done" : 1,
            "mutedTopics" : getMutedTopics()
          });
        break;
        
        case 'clearMutedTopics':
          clearMutedTopics();
          sendResponse({"done":1});          
        break;
        
        case 'ignoreUser':
          if(request.objectId)
          {
            sendResponse({"done":1});
            ignoreUser(request.objectId);
          }
          else
          {
            sendResponse({"done":0});
          }
        break;
        
        case 'getIgnoredUsers':
          sendResponse({
            "done" : 1,
            "ignoredUsers" : getIgnoredUsers()
          });
        break;
        
        case 'clearIgnoredUsers':
          clearIgnoredUsers();
          sendResponse({"done":1});          
        break;
      }
    }
    else
    {
      sendResponse({"done":0});
    }
  });
</script>
</head>
</html>